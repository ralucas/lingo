// Generated by CoffeeScript 1.6.3
(function() {
  var correctAns, createWordsObj, quizWords, quizzo, selectedQuiz, words;

  words = ['hello', 'goodbye', 'watch', 'phone', 'computer', 'taxi', 'hotel', 'country', 'help', 'lost', 'cost', 'go'];

  selectedQuiz = String;

  quizWords = {};

  quizzo = [];

  createWordsObj = function(arr) {
    var i, _i, _len;
    quizzo.length = 0;
    for (_i = 0, _len = arr.length; _i < _len; _i++) {
      i = arr[_i];
      quizWords = {
        "text": i,
        "from": "eng",
        "to": selectedQuiz
      };
      quizzo.push(quizWords);
    }
    return quizzo;
  };

  correctAns = function(answer, value) {
    if (answer === value) {
      return '✓';
    } else {
      return '✘' + '  ' + answer;
    }
  };

  $(function() {
    $('#word-form').on('submit', function(event) {
      var langFrom, langTo, word, wordObj;
      event.preventDefault();
      $('#trans-word').empty();
      word = $(this).find('#word').val();
      langFrom = $(this).closest('#main').find('#selectFrom option:selected').attr('data-lang');
      langTo = $(this).closest('#main').find('#selectTo option:selected').attr('data-lang');
      wordObj = {
        text: word,
        from: langFrom,
        to: langTo
      };
      $.post('/translate', wordObj, function(data) {
        $('#trans-word').append('<h3>Translated:</h3>' + '<p class="lead">' + data.translation + '</p>');
      });
    });
    $.get('/lang', function(results) {
      var i, _i, _len;
      for (_i = 0, _len = results.length; _i < _len; _i++) {
        i = results[_i];
        if (i['to']['code'] !== 'eng') {
          $('#selectQuiz').append('<option data-lang=' + i['to']['code'] + '>' + i['to']['fullName'] + '</option>');
        }
      }
    });
    $('#selectQuiz').on('change', function() {
      var quizArr;
      selectedQuiz = $('#selectQuiz option:selected').attr('data-lang');
      quizArr = createWordsObj(words);
      $('#quiz').empty();
      $('#quiz').append('<h2>Please wait while your quiz is loading</h2>');
      $.post('/displayQuiz', {
        objArr: quizArr
      }, function(data) {
        var i, _i, _len;
        $('#quiz').empty();
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          i = data[_i];
          $('#quiz').append('<li class="list-group-item">' + i['translation'] + '<input class="answer-input" type="text" placeholder="Enter Answer"></li>');
        }
        $('#quiz li').each(function(j) {
          $(this).attr('data-eng', quizArr[j]['text']);
        });
      });
    });
    $('#quiz').on('blur', '.answer-input', function(e) {
      var answer, response, value;
      value = $(this).val().toLowerCase();
      answer = $(this).parent().attr('data-eng');
      response = correctAns(answer, value);
      $(this).attr('disabled', 'disabled');
      $(this).parent().append('<span class=response>' + response + '</span>');
      if (response === '✓') {
        $(this).next().css('color', 'green');
      } else {
        $(this).next().css('color', 'red');
      }
    });
  });

}).call(this);
